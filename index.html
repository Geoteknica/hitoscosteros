<!DOCTYPE html>

<html>

<head>

    <title>Hitos costeros</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- reference to Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""/>


    <!-- reference to Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""></script>


    <!-- reference to jquery -->
    <script src="src/jquery-2.1.1.min.js"></script>
    <!-- reference to ajax -->
    <script src="src/leaflet.ajax.min.js"></script>

    <!-- Load Leaflet search para hacer busquedas en una capa -->
      <link rel="stylesheet" href="src/leaflet-search.src.css"/>
      <script src="src/leaflet-search.src.js"></script>

    <!-- Load Grouped Layer Control -->
      <link rel="stylesheet" href="src/leaflet.groupedlayercontrol.min.css">
      <script src="src/leaflet.groupedlayercontrol.min.js" type="text/javascript"></script>

    <!-- Load Font Awesome icons -->
    <script src="https://kit.fontawesome.com/05f8f33024.js" crossorigin="anonymous"></script>

    <!--Load Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@700&family=Roboto:ital,wght@0,400;1,700&display=swap" rel="stylesheet">
    <!-- Load Leaflet locate -->
    <link rel="stylesheet" href="src/L.Control.Locate.min.css" />
    <script src="src/L.Control.Locate.min.js"></script>
    <!-- Load L.EasyButton -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <!-- Load L.ControlWindow -->
    <script src="src/L.Control.Window.js"></script>
    <link rel="stylesheet" href="src/L.Control.Window.css" />
    <!-- set width and height styles for map -->
    
    <link rel="stylesheet" href="styles.css">

    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
      
        #map {
            height: 100%;
            position:relative;
        }
      
    </style>

</head>

<body onload="myFunction()">
  
  <div class="navbar"> Hitos Costeros </div>   
  
  <div class="texto">
    <h2>¿Qué son los hitos costeros?</h2>
    <p>Para propósitos de este proyecto, los hitos son definidos como áreas pequeñas de origen natural o construido con un gran valor natural, de paisaje o escénico, cultural-histórico-patrimonial o recreativo. Se identificaron los hitos dentro de lo que es definido como el componente terrestre de la zona costanera en el documento rector del Programa de Manejo de la Zona Costanera de Puerto Rico. Es decir, “una franja de un kilómetro tierra adentro, así como distancias adicionales necesarias para incluir sistemas naturales clave de la costa”. Además, se incluyeron los hitos en las islas y cayos dentro de las aguas territoriales, lo que según la definición oficial serían parte del componente marino de la zona costanera. 
      Para facilitar el proceso de identificar los hitos, se establecieron dos categorías principales: hitos naturales e hitos construidos. A su vez, estos fueron clasificados en cinco categorías y divididos en subcategorías según sus características:
    </p>
    <img src="img/Infogra-categorias-subcategorias.svg" class="center">
    <h4>Los hitos están identificados en el visualizador por colores según sus categorías. Estas se definen de la siguiente manera:</h4>
    </p>
    <p>
      <ul>
      <svg viewBox="0 0 20 20" width="20" height="20">
        <circle cx="10" cy="14" r="5" fill="#CA8C46" /></svg>
      <strong> Geológicos-geomorfológicos:</strong> Lugares emblemáticos de carácter natural que surgen como resultado de procesos ocurridos en y bajo la superficie de la Tierra. Pueden presentar o estar relacionados a eventos o procesos históricos o contemporáneos, incluyendo los procesos climatológicos, tectónicos, volcánicos, de erosión, y de formaciones rocosas o minerales.<br>
      <svg viewBox="0 0 20 20" width="20" height="20">
        <circle cx="10" cy="14" r="5" fill="#004C62" /></svg>
      <strong> Hídricos:</strong> Lugares emblemáticos de carácter natural que son o forman parte de un cuerpo de agua, ya sea subterráneo o superficial, y que contienen un alto valor natural, recreativo o cultural.<br>
      <svg viewBox="0 0 20 20" width="20" height="20">
        <circle cx="10" cy="14" r="5" fill="#114506" /></svg>
      <strong> Ecológicos:</strong> Lugares emblemáticos de carácter natural o construido, cuyo atractivo principal es su enlace con la vida silvestre y la ecología asociada al lugar.<br>
      <svg viewBox="0 0 20 20" width="20" height="20">
        <circle cx="10" cy="14" r="5" fill="#C7622E" /></svg>
      <strong> Históricos-culturales-patrimoniales:</strong> Lugares emblemáticos de carácter construido que tienen influencia cultural, espiritual o histórica, incluyendo aquellos asociados al transporte, desarrollo económico, eventos, periodos o personajes históricos, importancia arqueológica, valor religioso, entre otros.<br>
      <svg viewBox="0 0 20 20" width="20" height="20">
        <circle cx="10" cy="14" r="5" fill="#86A708" /></svg>
      <strong> Recreativos:</strong> Lugares emblemáticos de carácter construido utilizados principalmente para actividades de ocio y recreación, tales como, actividad física, deportes acuáticos, confraternización, eventos de música, arte y cultura, entre otros.<br>
    </ul>
    </p>
    <h2>¿Cómo utilizar este visualizador de hitos costeros?</h2>
    <p>Este mapa ofrece una oportunidad única de explorar los hitos costeros en Puerto Rico. En el filtro que aparece en la sección superior derecha puede encender o apagar los hitos por categoría.</p>
    <h2>¿Quién puede utilizar este visualizador de hitos costeros y para qué?</h2>
    <p>Este visualizador tiene el propósito de proveer una herramienta al público para explorar y aprender más sobre los hitos ubicados en la costa de Puerto Rico. Como las zonas costeras de Puerto Rico son áreas sensibles a los efectos derivados del cambio climático, los usuarios podrán conocer sobre algunos de estos riesgos a los que están expuestos los distintos hitos, así como otra información valiosa asociada a estos. Por ejemplo, podrá conocer si el hito cuenta con estacionamiento y con acceso para personas con impedimentos, si se encuentra cerca de alguna vereda o algún paseo, y cuán frecuentada es el área donde se ubica.</p>
    
  </div>
    <div id="layerLabel" style = "text-align: right; margin: 0;height: 25px; margin-left:0px;padding: 5px; color: snow; background-color:#004C62;line-height:25px;">¿Cuál categoría de hito costero te gustaría ver?        
    </div>
  
  <script src="data/hitos.js"></script>
  <script src="data/zonacostanera.js"></script>
  
    <!-- place holder for map -->
  <div id="map"></div>
  <div id="infografias" style="padding-bottom: 20px;"> 
    <img src="img/Infografia de ubicacion de hitos.png" class="center">
    <img src="img/Infografia de peligros naturales.png" class="center">
    <img src="img/Infografia de caracteristicas adicionales.png" class="center">
  </div>
  <div class="texto">
    <h2>¿Hay limitaciones en la información presentada?</h2>
    <p>Como parte del proyecto se consideró la accesibilidad de los hitos, incluyendo su cercanía a rampas para personas con discapacidad. Esta información fue obtenida del inventario del Plan Maestro de Acceso Público a las Costas de Puerto Rico, publicado por el Departamento de Recursos Naturales y Ambientales, en el cual se identifican 33 áreas costeras con acceso a rampa. En términos de accesibilidad a transporte colectivo, debido al límite de acceso a información georreferenciada, esta variable no fue considerada en esta etapa del proyecto.
      Como parte del proyecto, también se consideró la frecuencia de visitas. Esta información fue obtenida de datos de dispositivos móviles que miden la cantidad de personas que se encuentran en un punto o área de interés en un momento determinado. Con esta información, se calculó un promedio de visitas anuales de las áreas cercanas a los hitos, las cuales fueron divididas en tres categorías: frecuencia alta, frecuencia moderada y frecuencia baja.
    </p>  
  </div>  
  <!-- Footer -->
  <footer>
    <div class="row">
      <div class="col-1">
      <p>Este visualizador fue desarrollado por Estudios Técnicos, Inc. bajo contrato con el Departamento de Recursos Naturales y Ambientales. Esta agencia recibe fondos del Programa de Manejo de la Zona Costanera (PMZC), los cuales se trabajan a través de la Oficina del Programa de Zona Costanera y Cambio Climático. Esta oficina desarrolla productos que puedan ser utilizados por una variedad de audiencias. Como resultado, la Oficina ha identificado la oportunidad de crear un inventario digital de hitos ubicados en la zona costanera (coastal landmarks), el cual tiene el propósito de dar a conocer estos hitos y documentar elementos asociados a estos.  
        Este proyecto ha sido posible gracias a una subvención federal de la Administración Nacional Oceánica y Atmosférica (NOAA, por sus siglas en inglés) al Programa de Manejo de la Zona Costanera del Departamento de Recursos Naturales y Ambientales, mediante la aportación: NA19NOS4190136.</p>
      </div>
      <div class="col-2">
        <h3>Oficina del Programa de Manejo de la Zona Costanera y Cambio Climático</h3>
        <p>Teléfono: (787) 999-2200 ext. 2729 / Fax: (787) 999-2267
          Email: pmzc@drna.pr.gov<br>
          
          
          Dirección física:
          Piso 8, Edificio de Agencias Ambientales Cruz A. Matos
          Carretera 8838, km 6.3, sector El Cinco, Río Piedras<br>
          
          
          Dirección postal:
          San José Industrial Park
          1375 Ave Ponce de León
          San Juan, PR 00926</p>
      </div>
      <div class="col-3">
        <p>La Oficina del Programa de Manejo de la Zona Costanera y Cambio Climático (OPZCCC) agradece a la Oficina Estatal de Conservación Histórica (OECH) del Instituto de Cultura Puertorriqueña (ICP) por compartir información y fotos de las estructuras del Registro Nacional de Lugares Históricos y de otras propiedades con valor histórico.</p>
        <img src="img/logo PMZC.jpg" alt="PMZC LOGO"width="75" height="75" style="float:right">
        <img src="img/DRNA GOB.png" alt="DRNA LOGO"width="75" height="75" style="float:right">
        <img src="img/noaa.png" alt="NOAA LOGO"width="75" height="75" style="float:right">
        
      </div>
    </div>
  </footer>

<script>

      var lyrCarto;
      var lyrEsri;
      var searchsector;
      var ctlLayers;
      var baseLayers;
      var scale;

      

      //  create map object, tell it to live in 'map' div and give initial latitude, longitude, zoom values
      var map = L.map('map',{
          maxZoom: 18,
          minZoom: 10,
          maxBounds: [
            //south west
            [17.74140,-68.14912],
            //north east
            [19.02795,-65.16509]
          ],
      }).setView([18.253579, -66.378914],10);

//Botón para localizar al usuario
      var lc = L.control.locate({
          position: 'topleft',
          strings: {
              title: "Localízame",
              popup: "Usted está en esta área"
          },
          locateOptions: {
               enableHighAccuracy: true
          }
      }).addTo(map);
      
      
//Botón de info
      var textodeinfo= 'Lorem ipsum dolor sit amet, consectetur adipiscing elit';
      L.easyButton('fa-info', function(btn, map){
        var winMtds = L.control.window(map,{title: 'HEllo World', maxWidth:400,modal:true})
        .content(textodeinfo)
        .show()
      }, 'Información').addTo(map);

//  Crea y añade 2 mapas base, uno con la imagen y uno sin la imagen
      lyrCarto = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',{
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd',
          maxZoom: 19
      }).addTo(map);

      lyrEsri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
      });
// Agrupa los mapas base en una variable
      baseLayers = {
         "Mapa base": lyrCarto,
         "Imagen aérea": lyrEsri
      };
//Añadir los hitos
      var hitosCategorias = L.layerGroup().addTo(map);
      
      function colorPuntos(d) { 
      return d == "Ecológicos" ? '#114506' : 
      d == "Geológico-geomorfológico" ? '#CA8C46' : 
      d == "Hídricos" ? '#004C62' : 
      d == "Históricos, patrimoniales y culturales" ? '#C7622E' :
      d == "Recreativos" ? '#86A708' :
            '#000000'; 
      };

      function estilo_hitos (feature) {
      return{
        radius: 6,
        fillColor: colorPuntos(feature.properties.Categoria), 
          color: colorPuntos(feature.properties.Categoria), 
        weight: 1,
        opacity : 1,
        fillOpacity : 0.8
      };
      };
      function popup_hitos (feature, layer) {
        if (feature.properties.Peligros_naturales != null){
          var risks_naturales = feature.properties.Peligros_naturales.split(" / ")
          riesgos_popup = []
          for (let i = 0; i <risks_naturales.length; i++ ){
            riesgo_path = "img/symbols/" + risks_naturales[i].replace(/ /g,"_").replace(":", "").replace(",","") + ".svg"
            if (i== 0){
              riesgos_popup.push(  '<img src=' + riesgo_path + '>') 
            }else{
              riesgos_popup.push('<img src=' + riesgo_path + '>')
            }
          }
          layer.bindPopup("<div style=text-align:center><h3>"+feature.properties.Nombre+
            '<br><img src="img/'+feature.properties.etiid+'.JPG" style="width:100px;height:100px;"></br>'+
            "<p><small> Foto:"+feature.properties.Fuente_foto+
            "<h3></div><hr><table><tr><td><b>Categoria: </b>"+feature.properties.Categoria+
            "</td></tr><tr><td><b>Subcategoria: </b>"+feature.properties.Subcategoria+
            "</td></tr><tr><td><b>Uso o valor actual: </b>"+feature.properties.Uso_valor_actual+
            "</td></tr><tr><td><br><b>Peligros Naturales: </b></br>" +
              riesgos_popup+
            "</td></tr><tr><td><a href=fichas.html#" +feature.properties.etiid+" target='_blank'><br>Más Información</br></a>"+ 
            "</td></tr></table>") 
        } else{
          layer.bindPopup("<div style=text-align:center><h3>"+feature.properties.Nombre+
          '<br><img src="img/'+feature.properties.etiid+'.JPG" style="width:100px;height:100px;"></br>'+
          "<p><small> Foto:"+feature.properties.Fuente_foto+
          "<h3></div><hr><table><tr><td><b>Categoria: </b>"+feature.properties.Categoria+
          "</td></tr><tr><td><b>Subcategoria: </b>"+feature.properties.Subcategoria+
          "</td></tr><tr><td><b>Uso o valor actual: </b>"+feature.properties.Uso_valor_actual+
          "</td></tr><tr><td><a href=fichas.html#" +feature.properties.etiid+" target='_blank'><br>Más Información</br></a>"+ 
          "</td></tr></table>")
        }
		
      };

      var hito;
      
      var data_for_grouped_overlays = {}
      var distinc_values = [...new Set(hito.features.map(item=> item.properties.Categoria))]
      var riesgos_naturales_listado =[]
      for (let i =0; i<hito.features.length; i++){
        if ( hito.features[i].properties.Peligros_naturales !== null){
          var riesgos_split = hito.features[i].properties.Peligros_naturales.split(" / ")
          for (let j=0; j <riesgos_split.length; j++){
              riesgos_naturales_listado.push(riesgos_split[j])
          }
        }
      }
      var riesgos_distintos = [...new Set(riesgos_naturales_listado.map(item=> item))]
      function myFunction() { 
      for (let i = 0; i<distinc_values.length; i++){
        if (distinc_values[i] != null){
          var label_name = distinc_values[i].replace(/\s/g, '_')
        label_name = label_name.replace(/,/, '')
        window["Object"+i] = 'test'
        window["Object"+i] =  L.geoJSON(hito, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng);
              },
            filter: function(feature, layer) {			
                   if (feature.properties.Categoria == distinc_values[i] ){
                    return feature.properties.Categoria == distinc_values[i]
                   } 
                }
            ,	
            style:estilo_hitos,
            onEachFeature: popup_hitos	
        }).addTo(map);
        data_for_grouped_overlays[distinc_values[i]] = window["Object"+i]
        }
      }

    var groupedOverlays = {}
      groupedOverlays['Hitos'] = data_for_grouped_overlays
      var options = {
            exclusiveGroups: ["Hitos"],
            groupCheckboxes:false
        }
      
    var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays,zonacostanera)
      map.addControl(layerControl);
    }
//Añade la zona costanera y su estilo
    var zonacoststyle = {
    "color": "#76b5c5",
    "weight": 1,
    "opacity": 0.65
    };
    var zonacostanera = L.geoJson(zonacostanera,{
      style: zonacoststyle
    }).bindPopup("Zona Costanera").addTo(map);
    //layerControl.addOverlay(zonacostanera, "Zona Costanera");

    var legend = L.control({position: 'bottomright', collapsed: true});
    legend.onAdd = function (map){
      var div = L.DomUtil.create('div', 'info legend'),
      categories = distinc_values;
      console.log(categories)
      for (var i=0; i < categories.length; i++){
        console.log(categories[i] )
        if (categories[i] != null){
          div.innerHTML += '<i class="circle" style="background:' + colorPuntos(categories[i]) + '"></i> ' + categories[i] + '<br>';
        }
        }
      return div;
      }
    legend.addTo(map);
    
//Añade escala de barra
      scale = L.control.scale().addTo(map);
//Añade la fuente del mapa
      map.attributionControl.addAttribution("DRNA Oficina del Programa de Manejo de la Zona Costanera y Cambio Climático");

</script>

</body>

</html>
